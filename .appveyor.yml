version: '{build}'

cache:
- c:\tools\vcpkg\installed\ -> packages.txt

# We always want 32 and 64-bit compilation
matrix:
  fast_finish: false     # set this flag to immediately finish build once one of the jobs fails.

environment:
  stoken:
    secure: Zu/JtLX4O5watrgvqG+Hw6mPSepU7mOGm7aOehTwBhwUdI/89Ma+imgYKM+qERXG

install:
  - setlocal EnableExtensions EnableDelayedExpansion
  - copy c:\projects\nimbus-deps\triplets\*.* c:\tools\vcpkg\triplets\
build_script:
  - mkdir C:\projects\nimbus-deps\bin
  - mkdir C:\projects\nimbus-deps\bin\x86
  - mkdir C:\projects\nimbus-deps\bin\x64
  - vcpkg install zlib:x86-windows-static-crt
  - vcpkg install zlib:x64-windows-static-crt
  # - vcpkg install lz4:x86-windows-static-crt
  # - vcpkg install lz4:x64-windows-static-crt
  # - vcpkg install snappy:x86-windows-static-crt
  # - vcpkg install snappy:x64-windows-static-crt
  - copy c:\tools\vcpkg\installed\x86-windows-static-crt\bin\*.dll C:\projects\nimbus-deps\bin\x86\
  - copy c:\tools\vcpkg\installed\x64-windows-static-crt\bin\*.dll C:\projects\nimbus-deps\bin\x64\
  - 7z a -r nimbus-deps.zip C:\projects\nimbus-deps\bin\*.* > nul
test: off
deploy:
  release: nimbus-deps-v$(appveyor_build_version)
  description: 'Nimbus binary dependencies'
  provider: GitHub
  auth_token:
    secure: Zu/JtLX4O5watrgvqG+Hw6mPSepU7mOGm7aOehTwBhwUdI/89Ma+imgYKM+qERXG
  artifact: nimbus-deps.zip
  draft: false
  prerelease: false
  tag: $(APPVEYOR_REPO_TAG_NAME)
  # on:
  #   appveyor_repo_tag: true
